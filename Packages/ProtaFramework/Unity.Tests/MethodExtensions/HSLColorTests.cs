using NUnit.Framework;
using UnityEngine;
using Prota.Unity;
using System;
namespace Prota.Unity.Tests.MethodExtensions
{
    public class HSLColorTests
    {
        static float[][] HslRgbTestCases =
        {
            new float[] { 0.0f, 0.7f, 0.1f, 0.17f, 0.03f, 0.03f },
            new float[] { 0.0f, 0.7f, 0.18888888888888888f, 0.32111111111111107f, 0.0566666666666667f, 0.0566666666666667f },
            new float[] { 0.0f, 0.7f, 0.2777777777777778f, 0.4722222222222222f, 0.08333333333333337f, 0.08333333333333337f },
            new float[] { 0.0f, 0.7f, 0.3666666666666667f, 0.6233333333333334f, 0.10999999999999999f, 0.10999999999999999f },
            new float[] { 0.0f, 0.7f, 0.4555555555555556f, 0.7744444444444445f, 0.13666666666666671f, 0.13666666666666671f },
            new float[] { 0.0f, 0.7f, 0.5444444444444445f, 0.8633333333333333f, 0.22555555555555573f, 0.22555555555555573f },
            new float[] { 0.0f, 0.7f, 0.6333333333333333f, 0.8899999999999999f, 0.3766666666666667f, 0.3766666666666667f },
            new float[] { 0.0f, 0.7f, 0.7222222222222222f, 0.9166666666666665f, 0.5277777777777779f, 0.5277777777777779f },
            new float[] { 0.0f, 0.7f, 0.8111111111111111f, 0.9433333333333334f, 0.6788888888888889f, 0.6788888888888889f },
            new float[] { 0.0f, 0.7f, 0.9f, 0.9700000000000001f, 0.83f, 0.83f },
            new float[] { 0.1f, 0.7f, 0.1f, 0.17f, 0.11400000000000002f, 0.03f },
            new float[] { 0.1f, 0.7f, 0.18888888888888888f, 0.32111111111111107f, 0.21533333333333332f, 0.0566666666666667f },
            new float[] { 0.1f, 0.7f, 0.2777777777777778f, 0.4722222222222222f, 0.3166666666666667f, 0.08333333333333337f },
            new float[] { 0.1f, 0.7f, 0.3666666666666667f, 0.6233333333333334f, 0.41800000000000004f, 0.10999999999999999f },
            new float[] { 0.1f, 0.7f, 0.4555555555555556f, 0.7744444444444445f, 0.5193333333333334f, 0.13666666666666671f },
            new float[] { 0.1f, 0.7f, 0.5444444444444445f, 0.8633333333333333f, 0.6082222222222222f, 0.22555555555555573f },
            new float[] { 0.1f, 0.7f, 0.6333333333333333f, 0.8899999999999999f, 0.6846666666666666f, 0.3766666666666667f },
            new float[] { 0.1f, 0.7f, 0.7222222222222222f, 0.9166666666666665f, 0.7611111111111111f, 0.5277777777777779f },
            new float[] { 0.1f, 0.7f, 0.8111111111111111f, 0.9433333333333334f, 0.8375555555555556f, 0.6788888888888889f },
            new float[] { 0.1f, 0.7f, 0.9f, 0.9700000000000001f, 0.914f, 0.83f },
            new float[] { 0.2f, 0.7f, 0.1f, 0.142f, 0.17f, 0.03f },
            new float[] { 0.2f, 0.7f, 0.18888888888888888f, 0.26822222222222214f, 0.32111111111111107f, 0.0566666666666667f },
            new float[] { 0.2f, 0.7f, 0.2777777777777778f, 0.3944444444444444f, 0.4722222222222222f, 0.08333333333333337f },
            new float[] { 0.2f, 0.7f, 0.3666666666666667f, 0.5206666666666666f, 0.6233333333333334f, 0.10999999999999999f },
            new float[] { 0.2f, 0.7f, 0.4555555555555556f, 0.6468888888888888f, 0.7744444444444445f, 0.13666666666666671f },
            new float[] { 0.2f, 0.7f, 0.5444444444444445f, 0.7357777777777776f, 0.8633333333333333f, 0.22555555555555573f },
            new float[] { 0.2f, 0.7f, 0.6333333333333333f, 0.7873333333333331f, 0.8899999999999999f, 0.3766666666666667f },
            new float[] { 0.2f, 0.7f, 0.7222222222222222f, 0.8388888888888887f, 0.9166666666666665f, 0.5277777777777779f },
            new float[] { 0.2f, 0.7f, 0.8111111111111111f, 0.8904444444444444f, 0.9433333333333334f, 0.6788888888888889f },
            new float[] { 0.2f, 0.7f, 0.9f, 0.9420000000000001f, 0.9700000000000001f, 0.83f },
            new float[] { 0.3f, 0.7f, 0.1f, 0.057999999999999996f, 0.17f, 0.03f },
            new float[] { 0.3f, 0.7f, 0.18888888888888888f, 0.10955555555555556f, 0.32111111111111107f, 0.0566666666666667f },
            new float[] { 0.3f, 0.7f, 0.2777777777777778f, 0.16111111111111112f, 0.4722222222222222f, 0.08333333333333337f },
            new float[] { 0.3f, 0.7f, 0.3666666666666667f, 0.21266666666666667f, 0.6233333333333334f, 0.10999999999999999f },
            new float[] { 0.3f, 0.7f, 0.4555555555555556f, 0.26422222222222225f, 0.7744444444444445f, 0.13666666666666671f },
            new float[] { 0.3f, 0.7f, 0.5444444444444445f, 0.3531111111111112f, 0.8633333333333333f, 0.22555555555555573f },
            new float[] { 0.3f, 0.7f, 0.6333333333333333f, 0.4793333333333333f, 0.8899999999999999f, 0.3766666666666667f },
            new float[] { 0.3f, 0.7f, 0.7222222222222222f, 0.6055555555555556f, 0.9166666666666665f, 0.5277777777777779f },
            new float[] { 0.3f, 0.7f, 0.8111111111111111f, 0.7317777777777777f, 0.9433333333333334f, 0.6788888888888889f },
            new float[] { 0.3f, 0.7f, 0.9f, 0.858f, 0.9700000000000001f, 0.83f },
            new float[] { 0.4f, 0.7f, 0.1f, 0.03f, 0.17f, 0.08600000000000003f },
            new float[] { 0.4f, 0.7f, 0.18888888888888888f, 0.0566666666666667f, 0.32111111111111107f, 0.1624444444444445f },
            new float[] { 0.4f, 0.7f, 0.2777777777777778f, 0.08333333333333337f, 0.4722222222222222f, 0.238888888888889f },
            new float[] { 0.4f, 0.7f, 0.3666666666666667f, 0.10999999999999999f, 0.6233333333333334f, 0.31533333333333347f },
            new float[] { 0.4f, 0.7f, 0.4555555555555556f, 0.13666666666666671f, 0.7744444444444445f, 0.391777777777778f },
            new float[] { 0.4f, 0.7f, 0.5444444444444445f, 0.22555555555555573f, 0.8633333333333333f, 0.4806666666666669f },
            new float[] { 0.4f, 0.7f, 0.6333333333333333f, 0.3766666666666667f, 0.8899999999999999f, 0.5820000000000001f },
            new float[] { 0.4f, 0.7f, 0.7222222222222222f, 0.5277777777777779f, 0.9166666666666665f, 0.6833333333333335f },
            new float[] { 0.4f, 0.7f, 0.8111111111111111f, 0.6788888888888889f, 0.9433333333333334f, 0.7846666666666667f },
            new float[] { 0.4f, 0.7f, 0.9f, 0.83f, 0.9700000000000001f, 0.886f },
            new float[] { 0.5f, 0.7f, 0.1f, 0.03f, 0.16999999999999998f, 0.17f },
            new float[] { 0.5f, 0.7f, 0.18888888888888888f, 0.0566666666666667f, 0.321111111111111f, 0.32111111111111107f },
            new float[] { 0.5f, 0.7f, 0.2777777777777778f, 0.08333333333333337f, 0.47222222222222215f, 0.4722222222222222f },
            new float[] { 0.5f, 0.7f, 0.3666666666666667f, 0.10999999999999999f, 0.6233333333333333f, 0.6233333333333334f },
            new float[] { 0.5f, 0.7f, 0.4555555555555556f, 0.13666666666666671f, 0.7744444444444444f, 0.7744444444444445f },
            new float[] { 0.5f, 0.7f, 0.5444444444444445f, 0.22555555555555573f, 0.8633333333333332f, 0.8633333333333333f },
            new float[] { 0.5f, 0.7f, 0.6333333333333333f, 0.3766666666666667f, 0.8899999999999998f, 0.8899999999999999f },
            new float[] { 0.5f, 0.7f, 0.7222222222222222f, 0.5277777777777779f, 0.9166666666666664f, 0.9166666666666665f },
            new float[] { 0.5f, 0.7f, 0.8111111111111111f, 0.6788888888888889f, 0.9433333333333334f, 0.9433333333333334f },
            new float[] { 0.5f, 0.7f, 0.9f, 0.83f, 0.9700000000000001f, 0.9700000000000001f },
            new float[] { 0.6f, 0.7f, 0.1f, 0.03f, 0.086f, 0.17f },
            new float[] { 0.6f, 0.7f, 0.18888888888888888f, 0.0566666666666667f, 0.16244444444444442f, 0.32111111111111107f },
            new float[] { 0.6f, 0.7f, 0.2777777777777778f, 0.08333333333333337f, 0.23888888888888887f, 0.4722222222222222f },
            new float[] { 0.6f, 0.7f, 0.3666666666666667f, 0.10999999999999999f, 0.31533333333333335f, 0.6233333333333334f },
            new float[] { 0.6f, 0.7f, 0.4555555555555556f, 0.13666666666666671f, 0.3917777777777778f, 0.7744444444444445f },
            new float[] { 0.6f, 0.7f, 0.5444444444444445f, 0.22555555555555573f, 0.4806666666666667f, 0.8633333333333333f },
            new float[] { 0.6f, 0.7f, 0.6333333333333333f, 0.3766666666666667f, 0.5819999999999999f, 0.8899999999999999f },
            new float[] { 0.6f, 0.7f, 0.7222222222222222f, 0.5277777777777779f, 0.6833333333333333f, 0.9166666666666665f },
            new float[] { 0.6f, 0.7f, 0.8111111111111111f, 0.6788888888888889f, 0.7846666666666666f, 0.9433333333333334f },
            new float[] { 0.6f, 0.7f, 0.9f, 0.83f, 0.886f, 0.9700000000000001f },
            new float[] { 0.7f, 0.7f, 0.1f, 0.0579999999999999f, 0.03f, 0.17f },
            new float[] { 0.7f, 0.7f, 0.18888888888888888f, 0.10955555555555538f, 0.0566666666666667f, 0.32111111111111107f },
            new float[] { 0.7f, 0.7f, 0.2777777777777778f, 0.16111111111111087f, 0.08333333333333337f, 0.4722222222222222f },
            new float[] { 0.7f, 0.7f, 0.3666666666666667f, 0.2126666666666663f, 0.10999999999999999f, 0.6233333333333334f },
            new float[] { 0.7f, 0.7f, 0.4555555555555556f, 0.2642222222222218f, 0.13666666666666671f, 0.7744444444444445f },
            new float[] { 0.7f, 0.7f, 0.5444444444444445f, 0.3531111111111108f, 0.22555555555555573f, 0.8633333333333333f },
            new float[] { 0.7f, 0.7f, 0.6333333333333333f, 0.47933333333333294f, 0.3766666666666667f, 0.8899999999999999f },
            new float[] { 0.7f, 0.7f, 0.7222222222222222f, 0.6055555555555554f, 0.5277777777777779f, 0.9166666666666665f },
            new float[] { 0.7f, 0.7f, 0.8111111111111111f, 0.7317777777777776f, 0.6788888888888889f, 0.9433333333333334f },
            new float[] { 0.7f, 0.7f, 0.9f, 0.8579999999999999f, 0.83f, 0.9700000000000001f },
            new float[] { 0.8f, 0.7f, 0.1f, 0.142f, 0.03f, 0.17f },
            new float[] { 0.8f, 0.7f, 0.18888888888888888f, 0.26822222222222214f, 0.0566666666666667f, 0.32111111111111107f },
            new float[] { 0.8f, 0.7f, 0.2777777777777778f, 0.3944444444444444f, 0.08333333333333337f, 0.4722222222222222f },
            new float[] { 0.8f, 0.7f, 0.3666666666666667f, 0.5206666666666666f, 0.10999999999999999f, 0.6233333333333334f },
            new float[] { 0.8f, 0.7f, 0.4555555555555556f, 0.6468888888888888f, 0.13666666666666671f, 0.7744444444444445f },
            new float[] { 0.8f, 0.7f, 0.5444444444444445f, 0.7357777777777776f, 0.22555555555555573f, 0.8633333333333333f },
            new float[] { 0.8f, 0.7f, 0.6333333333333333f, 0.7873333333333331f, 0.3766666666666667f, 0.8899999999999999f },
            new float[] { 0.8f, 0.7f, 0.7222222222222222f, 0.8388888888888887f, 0.5277777777777779f, 0.9166666666666665f },
            new float[] { 0.8f, 0.7f, 0.8111111111111111f, 0.8904444444444444f, 0.6788888888888889f, 0.9433333333333334f },
            new float[] { 0.8f, 0.7f, 0.9f, 0.9420000000000001f, 0.83f, 0.9700000000000001f },
            new float[] { 0.9f, 0.7f, 0.1f, 0.17f, 0.03f, 0.11399999999999999f },
            new float[] { 0.9f, 0.7f, 0.18888888888888888f, 0.32111111111111107f, 0.0566666666666667f, 0.21533333333333327f },
            new float[] { 0.9f, 0.7f, 0.2777777777777778f, 0.4722222222222222f, 0.08333333333333337f, 0.31666666666666665f },
            new float[] { 0.9f, 0.7f, 0.3666666666666667f, 0.6233333333333334f, 0.10999999999999999f, 0.4179999999999999f },
            new float[] { 0.9f, 0.7f, 0.4555555555555556f, 0.7744444444444445f, 0.13666666666666671f, 0.5193333333333333f },
            new float[] { 0.9f, 0.7f, 0.5444444444444445f, 0.8633333333333333f, 0.22555555555555573f, 0.6082222222222222f },
            new float[] { 0.9f, 0.7f, 0.6333333333333333f, 0.8899999999999999f, 0.3766666666666667f, 0.6846666666666665f },
            new float[] { 0.9f, 0.7f, 0.7222222222222222f, 0.9166666666666665f, 0.5277777777777779f, 0.7611111111111111f },
            new float[] { 0.9f, 0.7f, 0.8111111111111111f, 0.9433333333333334f, 0.6788888888888889f, 0.8375555555555556f },
            new float[] { 0.9f, 0.7f, 0.9f, 0.9700000000000001f, 0.83f, 0.914f },
        };

        [Test]
        [TestCaseSource(nameof(HslRgbTestCases))]
        public void HSL_To_RGB_Conversion_Matches_CSV(float h, float s, float l, float r, float g, float b)
        {
            var hsl = new HSLColor(h, s, l);
            var color = hsl.ToColor();
            float tolerance = 0.01f;
            Assert.That(color.r, Is.EqualTo(r).Within(tolerance), $"R mismatch for HSL({h},{s},{l})");
            Assert.That(color.g, Is.EqualTo(g).Within(tolerance), $"G mismatch for HSL({h},{s},{l})");
            Assert.That(color.b, Is.EqualTo(b).Within(tolerance), $"B mismatch for HSL({h},{s},{l})");
        }

        [Test]
        [TestCaseSource(nameof(HslRgbTestCases))]
        public void RGB_To_HSL_Conversion_Matches_CSV(float h, float s, float l, float r, float g, float b)
        {
             var color = new Color(r, g, b);
             var hsl = (HSLColor)color;
             float tolerance = 0.01f;
             float diffH = Mathf.Abs(hsl.h - h);
             if(diffH > 0.5f) diffH = 1.0f - diffH;
             if (s > 0.01f && l > 0.01f && l < 0.99f)
             {
                 Assert.That(diffH, Is.LessThan(tolerance), $"Hue mismatch for RGB({r},{g},{b}) -> Got HSL({hsl.h},{hsl.s},{hsl.l}) Expected H:{h}");
             }
             if (l > 0.01f && l < 0.99f)
             {
                 Assert.That(hsl.s, Is.EqualTo(s).Within(tolerance), "Saturation mismatch");
             }
             Assert.That(hsl.l, Is.EqualTo(l).Within(tolerance), "Lightness mismatch");
        }
    }
}
